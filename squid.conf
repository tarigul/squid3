
#== Global options:===============
http_port               127.0.0.1:3128 accel 
http_port               10.0.0.2:3128
http_port               192.168.2.2:3128 accel


pid_filename            /var/run/squid.pid
hosts_file              /etc/hosts
error_directory         /usr/share/squid3/errors/templates
visible_hostname        none


#== IPv6 bullshit: ===============
tcp_outgoing_address    192.168.2.2 all
dns_v4_first            on
dns_nameservers         localhost

#== Squid in the middle ==========
#http_port               192.168.2.2:3129 transparent ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/SquidMITM/squid.pem key=/etc/squid3/SquidMITM/squid.key

#http_port               192.168.2.2:3129 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB cert=/etc/squid3/SquidMITM/squidCA.pem key=/etc/squid3/SquidMITM/squidCA.pem

#sslproxy_capath          /etc/ssl/certs 
#sslcrtd_program         /usr/lib/squid3/ssl_crtd -s /var/lib/ssl_db -M 16MB



#== Logging: =====================
logfile_rotate          1
access_log              stdio:/var/log/squid3/access.log squid
cache_store_log         stdio:/var/log/squid3/store.log
cache_log               /var/log/squid3/cache.log

logfile_daemon          /usr/lib/squid3/log_file_daemon

#== Squid Cache: =================
#cache_mem               	512 MB
#maximum_object_size     	512 KB
#maximum_object_size_in_memory   512 KB
#memory_replacement_policy       heap    GDSF

#== Elite anonomising: ===========
request_header_access   X-Forwarded-For deny    all
request_header_access   Via             deny    all
request_header_access   Cache-Control   deny    all
follow_x_forwarded_for  		allow  	all
acl_uses_indirect_client		on
delay_pool_uses_indirect_client		on
log_uses_indirect_client		on


#== SquidGuard:===================
redirect_program        /usr/bin/squidGuard     -c /etc/squid3/squidGuard.conf
redirect_children       16
redirector_bypass       off


#== Squid ACL: ===================

#= White ports: ========
acl     allow_ports         port    80      # http
acl     allow_ports         port    81      # http
acl     allow_ports         port    443     # https

acl     allow_ports         port    37      # http

acl     allow_ports         port    20      # ftp
acl     allow_ports         port    21      # ftp

acl     allow_ports         port    25      # smtp
acl     allow_ports         port    465     # smtp-ssl

acl     allow_ports         port    110     # pop3
acl     allow_ports         port    995     # pop3-ssl

acl     allow_ports         port    143     # imap4
acl     allow_ports         port    993     # imap4-ssl

acl     allow_ports         port    1935     # imap4-ssl
acl     allow_ports         port    8888     # imap4-ssl

acl     allow_ports         port   1688     # _VLSC

#= Black ports: ========
acl     blocked_ports       port    3389
acl     blocked_ports       port    22      # SSH
acl     blocked_ports       port    23      # Telnet
acl     blocked_ports       port    34      # Remote File (RF)вЂ”used to transfer files between machines
acl     blocked_ports       port    56      # Route Access Protocol (RAP)
acl     blocked_ports       port    70      # Gopher
acl     blocked_ports       port    179     # BGP (Border Gateway Protocol)
acl     blocked_ports       port    194     # IRC
acl     blocked_ports       port    201     # AppleTalk
acl     blocked_ports       port    384     # A Remote Network Server System
acl     blocked_ports       port    411     # DC Hub
acl     blocked_ports       port    412     # DC c2c
acl     blocked_ports       port    513     # rlogin
acl     blocked_ports       port    514     # rsh
acl     blocked_ports       port    530     # RPC
acl     blocked_ports       port    653     # SupportSoft Nexus Remote Command (data): A proxy gateway connecting remote control traffic
acl     blocked_ports       port    808     # MS Net. Port Sharing
acl     blocked_ports       port    873     # rsync
acl     blocked_ports       port    901     # VMware Virtual Infrastructure Client
acl     blocked_ports       port    903     # VMware Remote Console
acl     blocked_ports       port    953     # RNDC
acl     blocked_ports       port    987     # MS HTTPS - SharePoint S
acl     blocked_ports       port    989     # FTPS
acl     blocked_ports       port    990     # FTPS
acl     blocked_ports       port    991     # NAS
acl     blocked_ports       port    992     # TELNET over TLS/SSL
acl     blocked_ports       port    1194    # OpenVPN
acl     blocked_ports       port    1200    # Steam Friends Applet Unofficial
acl     blocked_ports       port    1214    # Kazaa Official
acl     blocked_ports       port    1217    # Uvora Online
acl     blocked_ports       port    1234    # VLC stream
acl     blocked_ports       port    1241    # Nessus
acl     blocked_ports       port    1293    # IPSec
acl     blocked_ports       port    1701    # L2F / L2TP
acl     blocked_ports       port    1723    # Microsoft PPTP
acl     blocked_ports       port    1984    # Big Brother and related Xymon (formerly Hobbit) System and Network Monitor
acl     blocked_ports       port    2041    # Mail.Ru Agent
acl     blocked_ports       port    2056    # Civilization 4 multiplayer
acl     blocked_ports       port    2083    # radsec
acl     blocked_ports       port    2121    # FTP proxy
acl     blocked_ports       port    2200    # Tuxanci game
acl     blocked_ports       port    2302    # ArmA multiplayer
acl     blocked_ports       port    2302    # Halo
acl     blocked_ports       port    2593    # RunUOвЂ”Ultima Online server
acl     blocked_ports       port    2610    # Dark Ages
acl     blocked_ports       port    2710    # XBT Bittorrent Tracker Unofficial
acl     blocked_ports       port    3724    # World of Warcraft
acl     blocked_ports       port    3724    # World of Warcraft
acl     blocked_ports       port    3389    # Microsoft Terminal Server (RDP)
acl     blocked_ports       port    4000    # Diablo II game
acl     blocked_ports       port    4001    # Microsoft Ants game
acl     blocked_ports       port    4500    # IPSec NAT Traversal (RFC 3947)
acl     blocked_ports       port    4534    # Armagetron Advanced default server   port
acl     blocked_ports       port    4899    # Radmin
acl     blocked_ports       port    5000    # VTunвЂ”VPN Software
acl     blocked_ports       port    5150    # Malware Cerberus RAT
acl     blocked_ports       port    5190    # ICQ and AOL Instant Messenger
acl     blocked_ports       port    5222    # XMPP client connection
acl     blocked_ports       port    5223    # XMPP client connection over SSL
acl     blocked_ports       port    5498    # Hotline tracker server connection Unofficial
acl     blocked_ports       port    5499    # Hotline tracker server discovery
acl     blocked_ports       port    5500    # VNC remote desktop protocolвЂ”for incoming listening viewer, Hotline control connection
acl     blocked_ports       port    5501    # Hotline file transfer connection
acl     blocked_ports       port    5938    # TeamViewer
acl     blocked_ports       port    6969    # acmsoda Official
acl     blocked_ports       port    7700    # P2P DC (RedHub)
acl     blocked_ports       port    7777-7788 # Unreal Tournament series default server
acl     blocked_ports       port    8081    # HTTP alternate, VibeStreamer
acl     blocked_ports       port    8118    # PrivoxyвЂ”advertisement-filtering Web proxy
acl     blocked_ports       port    8887    # HyperVM HTTP Official
acl     blocked_ports       port    8888    # HyperVM HTTPS
acl     blocked_ports       port    9000    # SqueezeCenter web server & streaming
acl     blocked_ports       port    9001    # Microsoft Sharepoint Authoring Environment
acl     blocked_ports       port    9001    # Tor
acl     blocked_ports       port    9001    # DBGp Proxy
acl     blocked_ports       port    9030    # Tor
acl     blocked_ports       port    9050    # Tor
acl     blocked_ports       port    9051    # Tor
acl     blocked_ports       port    17500   # Dropbox
acl     blocked_ports       port    23399   # Skype Default Protocol
acl     blocked_ports       port    9999    # Mail-Agent por

#= Mothods: ============
#acl     purge           method  PURGE
#acl     CONNECT         method  CONNECT



#= Networks: ===========
acl     localnet            src     192.168.2.0/24
acl     ovpn-net            src     192.168.4.0/28

#= Users: ==============
#acl     System		src     	"/etc/squid3/users/system.list"

#acl     Library-215	src		"/etc/squid3/users/library-215.list"
#acl     Library-218	src		"/etc/squid3/users/library-218.list"

#acl     Langlab		src		"/etc/squid3/users/langlab.list"

#acl     Class-1		src		"/etc/squid3/users/class-1.list"
#acl     Class-2		src		"/etc/squid3/users/class-2.list"
#acl     Class-3		src		"/etc/squid3/users/class-3.list"
#acl     Class-4		src		"/etc/squid3/users/class-4.list"
#acl     Class-5		src		"/etc/squid3/users/class-5.list"
#acl     Class-6		src		"/etc/squid3/users/class-6.list"
#acl     Class-7		src		"/etc/squid3/users/class-7.list"


#= DanseGuardian: ======
acl     DanseGuardian       src     127.0.0.1/32
#acl     Blocked_address     src     "/etc/squid3/SquidUsers/Blocked_Address.list"









#= Squid Lists: ========
#acl     White_System    dstdomain   "/etc/squid3/lists/White_System.list"
#acl     White_Other     dstdomain   "/etc/squid3/lists/White_Other.list"
#acl     White_Edu       dstdomain   "/etc/squid3/lists/White_Edu.list"
#acl     White_Exam      dstdomain   "/etc/squid3/lists/White_Exam.list"

#acl     Black_SSL       dstdomain   "/etc/squid3/BlackLists/Black_SSL.list"

#== MIME/Regex: ==================





#== HTTP Access: =================
#http_access         deny    DanseGuardian
#http_access         deny    all

#= HTTPS Block: ==
#http_access         deny    Students_Library Black_SSL
#http_access         deny    System_Guests Black_SSL

#http_access         deny    Students_Class-1 Black_SSL
#http_access         deny    Students_Class-2 Black_SSL
#http_access         deny    Students_Class-3 Black_SSL
#http_access         deny    Students_Class-4 Black_SSL
#http_access         deny    Students_Class-5 Black_SSL
#http_access         deny    Students_Class-6 Black_SSL
#http_access         deny    Students_Class-7 Black_SSL

#= Open Ports: ===
#http_access         allow   allow_ports     System_Servers
#http_access         allow   blocked_ports   System_Servers
#
#http_access         allow   allow_ports     System_Admins
#http_access         allow   blocked_ports   System_Admins
#
#http_access         allow   allow_ports     Users_Directorate
#http_access         allow   blocked_ports   USers_Directorate
#
#http_access         allow   allow_ports     Users_Other
#http_access         allow   blocked_ports   Users_Other
#
#http_access         allow   allow_ports     Users_Limited
#http_access         allow   allow_ports     Users_SixthPool
#
#http_access         allow   allow_ports     Students_Library

#http_access allow Students_Class-1 allow_ports
#http_access allow Students_Class-2 allow_ports
#http_access allow Students_Class-3 allow_ports
#http_access allow Students_Class-4 allow_ports
#http_access allow Students_Class-5 allow_ports
#http_access allow Students_Class-6 allow_ports

#http_access         allow   allow_ports     localnet

#http_access         allow   allow_ports     ovpn-net
#http_access         allow   blocked_ports   ovpn-net

#http_access         allow   allow_ports     System_Guests

#= Closed Ports: =
#http_access         deny    blocked_ports   all

#= White Lists: ==
#http_access         allow   White_System    all
#http_access         allow   White_Exam      all

#= Students: =====

#http_access deny Users_Limited Black_SSL
#http_access allow Users_Limited White_Edu
#http_access allow Users_Limited White_Other
#http_access allow Users_Limited

#http_access deny  System_Guests Black_SSL
#http_access allow System_Guests White_Edu
#http_access allow System_Guests White_Other
#http_access allow System_Guests




#= Students: =====

#http_access         allow   White_Edu       DanseGuardian
#http_access         allow   White_Other     DanseGuardian
#http_access         deny    Black_SSL       DanseGuardian
#http_access         allow                   DanseGuardian

http_access         allow all





#= http access: ==


#acl TrustedName url_regex ^https://google.ru/
#sslproxy_cert_error allow TrustedName




#= HTTP Access:=







#== Squid in the middle: ========

#= SSL Block:=====


#always_direct allow all

#ssl_bump server-first localnet



#ssl_bump        client-first        Black_SSL

#ssl_bump        client-first        localnet
#ssl_bump        server-first        Users_Directorate

#ssl_bump        client-first        System_Guests

#ssl_bump        client-first        Students_Class-1
#ssl_bump        client-first        Students_Class-2
#ssl_bump        client-first        Students_Class-3
#ssl_bump        client-first        Students_Class-4
#ssl_bump        client-first        Students_Class-5
#ssl_bump        client-first        Students_Class-6


#ssl_bump server-first localnet

#sslproxy_cert_error allow all
#sslproxy_flags DONT_VERIFY_PEER

http_access deny localnet 
